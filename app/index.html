<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Bomberman 360x360 Map</title>
  <style>
    body {
      background-color: #1a1a1a;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
    }

    /* --- THE 360x360 WORLD --- */
    #game-world {
      position: relative;
      /* 9 columns * 40px = 360px */
      width: 750px;
      /* 9 rows * 40px = 360px */
      height: 750px;
      background-color: #2e4e35;
      overflow: hidden;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
      border: 4px solid #000;
    }

    .sprite {
      position: absolute;
      /* New Tile Size */
      width: 50px;
      height: 50px;
      will-change: transform;
      top: 0;
      left: 0;
    }

    /* --- TILE DEFINITIONS (Scaled Coordinates) --- */

    .tile-wall {
      /* New Tile Size */
      background-image: url("./assets/map21.jpg");

      /* --- SCALING THE 64px IMAGE DOWN TO 40px --- */
      /* Assuming the original image was roughly 1024px wide (16 tiles) */
      /* We scale it down to 62.5% of its original size */
      background-size: cover;
      image-rendering: pixelated;
      image-rendering: crisp-edges;
      z-index: 10;
    }

    .tile-wall-edge {
      /* New Tile Size */
      background-image: url("./assets/map23.jpg");

      /* --- SCALING THE 64px IMAGE DOWN TO 40px --- */
      /* Assuming the original image was roughly 1024px wide (16 tiles) */
      /* We scale it down to 62.5% of its original size */
      background-size: cover;
      image-rendering: pixelated;
      image-rendering: crisp-edges;
      z-index: 10;
    }

    .tile-block {


      background-image: url("./assets/map20.jpg");
      background-repeat: no-repeat;

      /* --- SCALING THE 64px IMAGE DOWN TO 40px --- */
      /* Assuming the original image was roughly 1024px wide (16 tiles) */
      /* We scale it down to 62.5% of its original size */
      background-size: cover;
      image-rendering: pixelated;
      image-rendering: crisp-edges;

      z-index: 5;
    }

    .tile-floor {

      background-image: url("./assets/map19.jpg");
      background-repeat: no-repeat;

      /* --- SCALING THE 64px IMAGE DOWN TO 40px --- */
      /* Assuming the original image was roughly 1024px wide (16 tiles) */
      /* We scale it down to 62.5% of its original size */
      background-size: cover;
      will-change: transform;
      image-rendering: pixelated;
      image-rendering: crisp-edges;
      z-index: 0;
    }

    .tile-stone {
      background-image: url("./assets/map35.jpg");
      background-repeat: no-repeat;

      /* --- SCALING THE 64px IMAGE DOWN TO 40px --- */
      /* Assuming the original image was roughly 1024px wide (16 tiles) */
      /* We scale it down to 62.5% of its original size */
      background-size: cover;
      will-change: transform;
      image-rendering: pixelated;
      image-rendering: crisp-edges;
      z-index: 0;
    }

    .tile-player {
      /* Original: -512px 0px (Col 8) */
      /* Scaled: -512 * 0.625 = -320 */
      background-position: -320px 0px;
      z-index: 20;
    }

    .broken {
      opacity: 0;
      transform: scale(0.5);
    }
  </style>
</head>

<body>
  <div id="game-world"></div>

  <script>
    // NEW TILE SIZE
    const TILE_SIZE = 50;
    const GAME_WIDTH = 750;
    const GAME_HEIGHT = 750;
    const COLS = GAME_WIDTH / TILE_SIZE;
    const ROWS = GAME_HEIGHT / TILE_SIZE;
    const WORLD = document.getElementById("game-world");
    const IMAGE_WIDTH = 35;
    const IMAGE_COLS = IMAGE_WIDTH / TILE_SIZE;

    // --- 9x9 MAP DATA (Standard Bomberman Layout) ---
    // 1 = Solid Wall
    // 0 = Floor
    // 2 = Breakable Block
    const LEVEL1 = [
      [3, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 3], // Row 0
      [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1], // Row 1
      [1, 0, 0, 2, 0, 2, 0, 0, 0, 0, 2, 0, 2, 0, 1], // Row 2 (Pillars)
      [1, 0, 0, 2, 0, 2, 0, 4, 0, 0, 2, 0, 2, 0, 1], // Row 2 (Pillars)
      [1, 0, 0, 2, 0, 2, 0, 4, 0, 0, 2, 0, 2, 0, 1], // Row 2 (Pillars)
      [1, 0, 0, 2, 0, 2, 0, 4, 0, 0, 2, 0, 2, 0, 1], // Row 2 (Pillars)
      [1, 0, 0, 2, 0, 2, 0, 4, 0, 0, 2, 0, 2, 0, 1], // Row 2 (Pillars)
      [1, 0, 0, 2, 0, 2, 0, 4, 0, 0, 2, 0, 2, 0, 1], // Row 2 (Pillars)
      [1, 0, 0, 2, 0, 2, 0, 0, 4, 0, 2, 0, 2, 0, 1], // Row 2 (Pillars)
      [1, 0, 0, 2, 0, 2, 0, 0, 4, 0, 2, 0, 2, 0, 1], // Row 2 (Pillars)
      [1, 0, 0, 2, 0, 2, 0, 0, 4, 0, 2, 0, 2, 0, 1], // Row 2 (Pillars)
      [1, 0, 0, 2, 0, 2, 0, 0, 4, 0, 2, 0, 2, 0, 1], // Row 2 (Pillars)
      [1, 0, 0, 2, 0, 2, 0, 0, 4, 0, 2, 0, 2, 0, 1], // Row 2 (Pillars)
      [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1], // Row 2 (Pillars)
      [3, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 3], // Row 0
    ];
    function getTile(col, row) {
      return LEVEL1[row][col];
    }

    function generateMap() {
      const fragment = document.createDocumentFragment();

      for (let row = 0; row < ROWS; row++) {
        for (let col = 0; col < COLS; col++) {
          const type = getTile(col, row);
          const x = col * TILE_SIZE;
          const y = row * TILE_SIZE;

          // 1. Floor everywhere
          if (type === 0) {

            createTile(fragment, "tile-floor", x, y, type, row, col);
          } else if (type === 1) {
            createTile(fragment, "tile-wall", x, y, type, row, col);
          } else if (type === 2) {
            // 3. Breakable Block
            createTile(fragment, "tile-block", x, y, type, row, col);
          } else if (type === 3) {
            // 4. Wall Edge
            createTile(fragment, "tile-wall-edge", x, y, type, row, col);
          } else if (type === 4) {
            // 4. Stone Floor
            createTile(fragment, "tile-stone", x, y, type, row, col);
          }
        }

        WORLD.appendChild(fragment);
      }
    }
    function createTile(container, className, x, y, type, row, col) {
      const el = document.createElement("div");
      console.log(row, ROWS, type);

      el.className = `sprite ${className}`;
      // Using translate3d for 60fps performance
      el.style.transform = `translate3d(${x}px, ${y}px, 0)`;
      if (row > 0 && row < ROWS - 1 && type == 1) {
        console.log(11111111);

        el.style.transform = `translate3d(${x}px, ${y}px, 0) rotate(90deg)`;
        if (col < COLS - 1) {
          el.style.backgroundImage = `url("./assets/map32.jpg")`;
          el.style.backgroundSize = `contain`;
          el.style.transform = `translate3d(${x}px, ${y}px, 0)`;
        }
      }
      if (row > 0 && row < ROWS && col < COLS - 1 && type == 1) {
        el.style.backgroundImage = `url("./assets/map32.jpg")`;
        el.style.backgroundSize = `contain`;
        el.style.transform = `translate3d(${x}px, ${y}px, 0)`;
        if (row === ROWS - 1) {
          el.style.transform = `translate3d(${x}px, ${y}px, 0) rotate(-90deg)`;

        }
      }
      if (row === 0 && col === COLS - 1 && type == 3) {
        console.log(22222222);
        el.style.transform = `translate3d(${x}px, ${y}px, 0) rotate(90deg)`;
      }
      if (row === ROWS - 1 && col === 0 && type == 3) {
        console.log(22222222);
        el.style.transform = `translate3d(${x}px, ${y}px, 0) rotate(-90deg)`;
      }
      if (row === ROWS - 1 && col === COLS - 1 && type == 3) {
        console.log(22222222);
        el.style.transform = `translate3d(${x}px, ${y}px, 0) rotate(180deg)`;
      }

      // el.style.backgroundPosition = `
      //   ${-(type * TILE_SIZE) % IMAGE_WIDTH}px 
      //   ${-Math.floor(type / IMAGE_COLS) * TILE_SIZE}px`;
      container.appendChild(el);
      return el;
    }

    function spawnPlayer(col, row) {
      // Calculates position based on the new 40px tile size
      createTile(WORLD, "tile-player", col * TILE_SIZE, row * TILE_SIZE);
    }

    generateMap();
  </script>
</body>

</html>